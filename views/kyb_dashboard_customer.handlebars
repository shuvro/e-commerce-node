<style>
    .vtabs .tabs-vertical {
        width: 250px;
    }

    .full-width-btn {
        width: 100%;
        margin: 5px 0;
    }

    .padding0 {
        padding: 0;
    }

    .customer-name {
        margin-top: 15px;
    }

    .maxHeigh135 {
        height: 135px;
    }

    .small-font h1 {
        font-size: 26px !important;
    }

    .error {
        color: red;
    }

</style>
{{#if error}}
    <div id="error" class="alert alert-danger" style="margin-top: 25px;">{{errMessage}}</div>
{{/if}}
<div class="row page-titles">
    <div class="col-md-5 align-self-center">
        <h4 class="text-themecolor">Conozca su cliente (Know your Customer)</h4>
    </div>
    <div class="col-md-7 align-self-center text-right">
        <div class="d-flex justify-content-end align-items-center">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">Tuidentidad / Cliente:</li>
            </ol>

        </div>
    </div>
</div>

<div class="row">
    <!-- Column -->
    <div class="col-lg-3 col-xlg-2 col-md-4">
        <div class="card"><img class="card-img" src="/img/bg1.jpg" height="280" alt="Card image">
            <div class="card-img-overlay card-inverse text-white social-profile d-flex justify-content-center">
                <div class="align-self-center"><img src="/img/profile-placeholder.png" class="img-circle" width="100">


                    {{#if isEdit}}
                        <input type="text" class="form-control mb-1 mt-1" placeholder="Name" id="name" name="name"
                               value="{{customer.name}}">
                        <input type="text" class="form-control mb-1" placeholder="Last Name" id="name" name="lastname"
                               value="{{customer.lastname}}">
                        <input type="text" class="form-control mb-1" placeholder="Second Last Name" id="name"
                               name="secondlastname"
                               value="{{customer.secondlastname}}">
                    {{else}}
                        <h4 class="card-title customer-name">{{customer.name}} {{customer.lastname}} {{customer.secondlastname}}</h4>
                    {{/if}}
                    <small>Agente Asignado <br> {{owner}} </small>
                </div>
            </div>
        </div>
        <div class="col-lg-12 col-xlg-12 col-md-12 padding0">
            <button type="button" class="btn waves-effect waves-light btn-outline-secondary full-width-btn" id="assign">
                Asignarme este proceso
            </button>
            <button type="button" class="btn waves-effect waves-light btn-warning full-width-btn" id="moreInfoBtn">
                Solicitar mas Información al cliente
            </button>
            {{#if_eq customer.status 'done'}}
                <button type="button" class="btn waves-effect waves-light btn-success full-width-btn" id="aprobar">
                    Aprobar
                </button>
                <button type="button" class="btn waves-effect waves-light btn-danger full-width-btn" id="rechazar">
                    Rechazar
                </button>
            {{/if_eq}}
            {{#if_not customer.status 'pending'}}
                <button type="button" class="btn waves-effect waves-light btn-outline-secondary full-width-btn" id="pdf">
                    Descargar PDF
                </button>
            {{/if_not}}
            {{#if isEdit}}
                <button type="button" class="btn waves-effect waves-light btn-dark full-width-btn"
                        id="btnEditCustomerInfo">Edit Customer Details
                </button>
            {{/if}}
        </div>
        <br>
        <div class="card">
            <div class="card-header">
                Comunicación con el cliente
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs customtab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#home2" role="tab" aria-selected="true">
                            <span class="hidden-sm-up"></span> <span class="hidden-xs-down">Solicitudes</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#profile2" role="tab" aria-selected="false">
                            <span class="hidden-sm-up"></span> <span class="hidden-xs-down">Rechazado</span>
                        </a>
                    </li>

                </ul>
                <div class="tab-content" style="max-height: 350px;height: 350px;overflow: auto;" id="scroller-div">
                    <div class="tab-pane active" id="home2" role="tabpanel">
                        <ul class="chat-list">
                            {{#each requestsInfo.mailBox}}
                                {{#if_eq to 'global'}}
                                    {{#if_eq msg null}}
                                        {{#if_length_greater_zero files 0}}
                                            <li>
                                                <div align="left">
                                                    <div class="chat-content">
                                                        <div class="box"
                                                             style="width:100%; background-color: #2BACD2; color: white">
                                                            <div
                                                                    class="row">
                                                                {{#each files}}
                                                                    <div class="col-sm-2">
                                                                        <a href="{{parseFileExt ../../sdkAPIendpoint
                                                                                                filename "1"}}"
                                                                           download
                                                                           target="_blank">
                                                                            <img
                                                                                    src="{{parseFileExt
                                                                                            ../../sdkAPIendpoint
                                                                                            filename "0"}}"
                                                                                    style="width: 33px; height: 33px;"/>
                                                                        </a>
                                                                    </div>
                                                                {{/each}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA
                                                            sent_at}}</div>
                                                </div>
                                            </li>
                                        {{/if_length_greater_zero}}
                                    {{/if_eq}}

                                    {{#if_not msg null}}
                                        {{#if_length_zero files 0}}
                                            <li>
                                                <div align="left">
                                                    <div class="chat-content">
                                                        <div class="box"
                                                             style="width:100%; background-color: #2BACD2; color: white">{{msg}}</div>
                                                    </div>
                                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA
                                                            sent_at}}</div>
                                                </div>
                                            </li>
                                        {{/if_length_zero}}
                                    {{/if_not}}

                                    {{#if_not msg null}}
                                        {{#if_length_greater_zero files 0}}
                                            <li>
                                                <div align="left">
                                                    <div class="chat-content">
                                                        <div class="box"
                                                             style="width:100%; background-color: #2BACD2; color: white">
                                                            <p>{{msg}}</p>
                                                            <!--                                                            <hr/>-->
                                                            <div
                                                                    class="row">
                                                                {{#each files}}
                                                                    <div class="col-sm-2">
                                                                        <a href="{{parseFileExt ../../sdkAPIendpoint
                                                                                                filename "1"}}"
                                                                           download
                                                                           target="_blank">
                                                                            <img
                                                                                    src="{{parseFileExt
                                                                                            ../../sdkAPIendpoint
                                                                                            filename "0"}}"
                                                                                    style="width: 33px; height: 33px;"/>
                                                                        </a>
                                                                    </div>
                                                                {{/each}}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA
                                                            sent_at}}</div>
                                                </div>
                                            </li>
                                        {{/if_length_greater_zero}}
                                    {{/if_not}}
                                {{/if_eq}}
                                {{#if_not to 'global'}}
                                    <li>
                                        <div align="right" class="mr-1">
                                            <div class="chat-content">
                                                <h5>{{sender}} </h5>
                                                <div class="box"
                                                     style="width:100%; background-color: #EAEAEA;">{{msg}}</div>
                                            </div>
                                            <div class="chat-time">{{parse_dateSSA
                                                    sent_at}}</div>
                                        </div>
                                    </li>
                                {{/if_not}}
                            {{else}}
                                <li>
                                    <div class="chat-content">
                                        <h5>No hay conversaciones</h5>
                                        {{!-- <div class="box bg-light-info">Well we have good budget for the project</div> --}}
                                    </div>
                                </li>
                            {{/each}}

                        </ul>
                    </div>
                    <div class="tab-pane" id="profile2" role="tabpanel">
                        <ul class="chat-list">
                            {{#each info.rejects}}
                                <li>
                                    <div class="chat-content">
                                        <h5>{{user.userName}} <span class="badge badge-danger">Rechazado</span></h5>
                                        <div class="box alert-wati" style="width:100%">{{message}}</div>
                                    </div>
                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA timestamp}}</div>
                                </li>
                            {{else}}
                                <li>
                                    <div class="chat-content">
                                        <h5>No hay rechazos</h5>
                                        {{!-- <div class="box bg-light-info">Well we have good budget for the project</div> --}}
                                    </div>
                                </li>
                            {{/each}}

                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body"><small class="text-muted">Email </small>
                {{#if isEdit}}
                    <input type="text" class="form-control mb-1" placeholder="Customer Email" id="email" name="email"
                           value="{{customer.email}}">
                    <input type="text" class="form-control mb-1" placeholder="Cell Phone" id="cellPhone"
                           name="cellPhone" value="{{customer.cellPhone}}">
                    <input type="text" class="form-control mb-1" placeholder="address" id="address" name="address"
                           value="{{customer.address}}">
                    <input type="hidden" id="customerId" name="customerId" value="{{customer._id}}">
                {{else}}
                    <h6>{{customer.email}}</h6> <small class="text-muted p-t-30 db">Teléfono</small>
                    <h6>{{customer.cellPhone}}</h6> <small class="text-muted p-t-30 db">Dirección</small>
                    <h6>{{customer.address}}</h6>
                {{/if}}

                <div class="map-box">
                    <iframe id="gmap_canvas" src="https://maps.google.com/maps?q={{customer.address}}
                    &t=&z=13&ie=UTF8&iwloc=&output=embed" width="100%" height="150" frameborder="0" scrolling="no"
                    marginheight="0" marginwidth="0"></iframe>
                </div>
                <small class="text-muted p-t-30 db">Redes Sociales</small>
                <br>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-facebook-f"></i></button>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-twitter"></i></button>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-youtube"></i></button>
            </div>
        </div>
    </div>
    <!-- Column -->
    <!-- Column -->

    <div class="col-lg-9 col-xlg-10 col-md-8">
        {{!-- <div class="card button-bar">

           <div class="btn-group pull-right" role="group" aria-label="Basic example">
               <button type="button" class="btn btn-secondary">Left</button>
               <button type="button" class="btn btn-secondary">Middle</button>
               <button type="button" class="btn btn-secondary">Right</button>
           </div>
       </div> --}}
        <div class="row">
            <!-- Column -->
            {{#if hasNoOwner}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-danger"> Este cliente no tiene ningun asesor asignado.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                    </div>
                </div>
            {{/if}}
            {{#if hasNoEmail}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-warning">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                        <h3 class="text-warning"><i class="fa fa-exclamation-triangle"></i> Precaución</h3> Este cliente
                        no tiene ningun correo electrónico asociado, es un nivel de riesgo alto.
                    </div>
                </div>
            {{/if}}
            {{#if_eq info.status 'approved'}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-info">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                        <h3 class="text-info"><i class="fa fa-exclamation-circle"></i> Importante</h3> Este cliente esta
                        en espera de revisión por parte de un supervisor.
                    </div>
                </div>
            {{/if_eq}}
            <!--            <div class="col-lg-3 col-md-6">-->
            <!--                <div class="card">-->
            <!--                    <div class="card-body maxHeigh135">-->
            <!--                        <div class="row p-t-10 p-b-10">-->
            <!--                            &lt;!&ndash; Column &ndash;&gt;-->
            <!--                            <div class="col p-r-0">-->
            <!--                                <h1 class="font-light">N/D</h1>-->
            <!--                                <h6 class="text-muted">Nivel de Riesgo</h6></div>-->
            <!--                            &lt;!&ndash; Column &ndash;&gt;-->
            <!--                            <div class="col text-right align-self-center">-->
            <!--                                <div data-label="20%" class="css-bar m-b-0 css-bar-primary css-bar-20"><i-->
            <!--                                        class="mdi mdi-account-circle"></i></div>-->
            <!--                            </div>-->
            <!--                        </div>-->
            <!--                    </div>-->
            <!--                </div>-->
            <!--            </div>-->
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-4 col-md-6">
                <div class="card">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">{{views}}</h1>
                                <h6 class="text-muted">Visualizaciones</h6></div>
                            <!-- Column -->
                            <div class="col text-right align-self-center">
                                <div data-label="30%" class="css-bar m-b-0 css-bar-danger css-bar-20"><i
                                        class="mdi mdi-briefcase-check"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-4 col-md-6">
                <div class="card">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">N/D</h1>
                                <h6 class="text-muted">Tiempo en el formulario</h6></div>
                            <!-- Column -->
                            <div class="col text-right align-self-center">
                                <div data-label="40%" class="css-bar m-b-0 css-bar-warning css-bar-40"><i
                                        class="mdi mdi-star-circle"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-4 col-md-6">
                <div class="card text-white {{parseStatusColor customer.status}}">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">{{parseStatus customer.status}}</h1>
                                <h6 class=" text-white">Estado</h6></div>
                            <!-- Column -->

                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
        </div>

        <div class="card">
            <!-- Nav tabs -->
            <div class="vtabs customvtab">
                <ul class="nav nav-tabs profile-tab tabs-vertical" role="tablist">
                    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#home" role="tab">Cédula
                        RFC</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#laboral" role="tab">Certificado
                        Fiel</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#politic" role="tab">Domicilio</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#founds" role="tab">Contacto</a>
                    </li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#banking" role="tab">Acta
                        Constitutiva</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#activity" role="tab">Tabla
                        Accionaria</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#attachements" role="tab">Apoderados</a>
                    </li>
                    {{!-- <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#history" role="tab">Historial</a> </li> --}}
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane active" id="home" role="tabpanel">
                        {{#each rfcInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-9">
                                        <div class="row">
                                            {{#each block.fields}}
                                                {{#unless @last}}
                                                    {{{drawInput label initialValue type isSelected desktopSize
                                                                 helper}}}
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        {{#each block.fields}}
                                            {{#if @last}}
                                                <div>
                                                    <label>{{this.label}}</label><br/>
                                                    <img src="{{parseFileExt ../../sdkAPIendpoint this.initialValue
                                                                             "0"}}"
                                                         style="width: 150px; height: 150px;"/>
                                                </div>
                                            {{/if}}
                                        {{/each}}
                                    </div>
                                </div>
                            </div>
                        {{else}}
                            Error retrieving Cédula RFC, please contact an Hubex Admin
                        {{/each}}

                    </div>
                    <!--second tab-->
                    <div class="tab-pane" id="laboral" role="tabpanel">
                        {{#each fielInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-9">
                                        <div class="row">
                                            {{#each block.fields}}
                                                {{#unless @last}}
                                                    {{{drawInput label initialValue type isSelected desktopSize
                                                                 helper}}}
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        {{#each block.fields}}
                                            {{#if @last}}
                                                <div>
                                                    <label>{{this.label}}</label><br/>
                                                    <img src="{{parseFileExt ../../sdkAPIendpoint this.initialValue
                                                                             "0"}}"
                                                         style="width: 150px; height: 150px;"/>
                                                </div>
                                            {{/if}}
                                        {{/each}}
                                    </div>
                                </div>
                            </div>
                        {{else}}
                            Error retrieving Certificado Fiel, please contact an Hubex Admin
                        {{/each}}
                    </div>
                    <div class="tab-pane" id="politic" role="tabpanel">
                        {{#each domicilioInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-sm-9">
                                        <div class="row">
                                            {{#each block.fields}}
                                                {{#unless @last}}
                                                    {{{drawInput label initialValue type isSelected desktopSize
                                                                 helper}}}
                                                {{/unless}}
                                            {{/each}}
                                        </div>
                                    </div>
                                    <div class="col-sm-3">
                                        {{#each block.fields}}
                                            {{#if @last}}
                                                <div>
                                                    <label>{{this.label}}</label><br/>
                                                    <img src="{{parseFileExt ../../sdkAPIendpoint this.initialValue
                                                                             "0"}}"
                                                         style="width: 150px; height: 150px;"/>
                                                </div>
                                            {{/if}}
                                        {{/each}}
                                    </div>
                                </div>
                            </div>
                        {{else}}
                            Error retrieving Domicilio, please contact an Hubex Admin
                        {{/each}}
                    </div>
                    <div class="tab-pane" id="founds" role="tabpanel">
                        <div class="card-body">
                            {{#each contactoInfo}}
                                <div class="card-header bg-info">
                                    <h4 class="m-b-0 text-white">{{block.name}}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-sm-12">
                                            <div class="row">
                                                {{#each block.fields}}
                                                    {{{drawInput label initialValue type isSelected desktopSize
                                                                 helper}}}
                                                {{/each}}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            {{else}}
                                Error retrieving Contacto, please contact an Hubex Admin
                            {{/each}}
                        </div>
                    </div>
                    <div class="tab-pane" id="banking" role="tabpanel">
                        <div class="card-body">
                            {{#each actaInfo}}
                                <div class="card-header bg-info">
                                    <h4 class="m-b-0 text-white">{{block.name}}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        <div class="col-sm-9">
                                            <div class="row">
                                                {{#each block.fields}}
                                                    {{#unless @last}}
                                                        {{{drawInput label initialValue type isSelected desktopSize
                                                                     helper}}}
                                                    {{/unless}}
                                                {{/each}}
                                            </div>
                                        </div>
                                        <div class="col-sm-3">
                                            {{#each block.fields}}
                                                {{#if @last}}
                                                    <div>
                                                        <label>{{this.label}}</label><br/>
                                                        <img src="{{parseFileExt ../../sdkAPIendpoint
                                                                                 this.initialValue "0"}}"
                                                             style="width: 150px; height: 150px;"/>
                                                    </div>
                                                {{/if}}
                                            {{/each}}
                                        </div>
                                    </div>
                                </div>
                            {{else}}
                                Error retrieving Acta Constitutiva, please contact an Hubex Admin
                            {{/each}}
                        </div>
                    </div>
                    <div class="tab-pane" id="activity" role="tabpanel">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="list-table"
                                       class="table no-wrap table-bordered m-t-30 table-hover contact-list footable footable-1 footable-paging footable-paging-center breakpoint-lg"
                                       data-paging="true" data-paging-size="7" style="">
                                    <thead>
                                    <tr class="footable-header">
                                        <th style="display: table-cell;">Nombre</th>
                                        <th style="display: table-cell;">CURP</th>
                                        <th style="display: table-cell;">Participación</th>
                                        <th class="footable-last-visible" style="display: table-cell;"></th>
                                    </tr>
                                    </thead>
                                    <tbody style="font-size: 12px;">
                                    {{#each accionistasInfo}}
                                        <tr>
                                            <td>{{nombre_completo}}</td>
                                            <td>{{curp}}</td>
                                            <td>{{percentage_de_participacion}}</td>
                                            <td>
                                                <!--                                                <a href="/kyb/{{../org}}/{{../currentProject}}/{{../carisId}}/view/{{_id}}"-->
                                                <!--                                                   class="table-actions" data-toggle="tooltip"-->
                                                <!--                                                   data-original-title="Editar ">-->
                                                <!--                                                    <i class="ti-eye"></i>-->
                                                <!--                                                </a>-->
                                                <button type="button" class="btn btn-primary accionistasSingleInfo"
                                                        data-id="{{_id}}"
                                                ><i
                                                        class="ti-eye"></i></button>
                                            </td>
                                        </tr>
                                    {{else}}
                                        <tr>
                                            <td colspan="5">No hay formularios para mostrar</td>
                                        </tr>
                                    {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane" id="attachements" role="tabpanel">
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="list-table-2"
                                       class="table no-wrap table-bordered m-t-30 table-hover contact-list footable footable-1 footable-paging footable-paging-center breakpoint-lg"
                                       data-paging="true" data-paging-size="7" style="">
                                    <thead>
                                    <tr class="footable-header">
                                        <th style="display: table-cell;">Nombre</th>
                                        <th style="display: table-cell;">CURP</th>
                                        <th class="footable-last-visible" style="display: table-cell;"></th>
                                    </tr>
                                    </thead>
                                    <tbody style="font-size: 12px;">
                                    {{#each apoderadosInfo}}
                                        <tr>
                                            <td>{{nombre_completo}}</td>
                                            <td>{{curp}}</td>
                                            <td>
                                                <button type="button" class="btn btn-primary apoderadosSingleInfo"
                                                        data-id="{{_id}}"
                                                ><i
                                                        class="ti-eye"></i></button>
                                            </td>
                                        </tr>
                                    {{else}}
                                        <tr>
                                            <td colspan="5">No hay formularios para mostrar</td>
                                        </tr>
                                    {{/each}}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Column -->
</div>
<div class="modal fade" id="more-Info" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Solicitar mas información</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <form>
                    <!-- <div class="form-group">
                        <label for="recipient-name" class="control-label">Razón del rechazo:</label>
                        <input type="text" class="form-control" id="recipient-name1">
                    </div> -->
                    {{!-- <div class="form-group">
                        <label for="message-text" class="control-label">Destinatario:</label>
                        <input class="form-control" id="message-header" type="text" />
                    </div> --}}
                    <div class="form-group">
                        <!-- <label for="message-text" class="control-label">:</label> -->
                        <textarea class="form-control" id="message-text" rows="10"></textarea>
                    </div>
                    <div id="msg-footer"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" id="saveRequestDetails" class="btn btn-primary">Enviar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="accionistasSingleInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Informacion</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Nombre Completo</label>
                                    <input type="text" class="form-control" id="nombre" placeholder="Nombre Completo"
                                           readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">CURP</label>
                                    <input type="text" class="form-control" id="curp" placeholder="CURP"
                                           readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">% de Participación</label>
                                    <input type="text" class="form-control" id="participation"
                                           placeholder="% de Participación"
                                           readonly>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Frontal</label>
                                        <img src=""
                                             class="rounded mx-auto d-block" alt="..."
                                             style="width: 250px; height: 250px" id="frontal">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Reverso</label>
                                        <img src=""
                                             class="rounded mx-auto d-block" alt="..."
                                             style="width: 250px; height: 250px" id="reverso">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="apoderadosSingleInfoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true" style="display: none;">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Informacion</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <div class="container">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Nombre Completo</label>
                                    <input type="text" class="form-control" id="nombre-2" placeholder="Nombre Completo"
                                           readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">CURP</label>
                                    <input type="text" class="form-control" id="curp-2" placeholder="CURP"
                                           readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="form-group">
                                    <label for="exampleInputEmail1">Poderes</label><br/>
                                    <input type="checkbox" id="podres_includes"
                                           disabled> Los poderes estan incluidos en el acta constitutiva
                                </div>
                            </div>
                        </div>
                        <div class="col-md-8">
                            <div class="row">
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Frontal</label>
                                        <img src=""
                                             class="rounded mx-auto d-block" alt="..."
                                             style="width: 250px; height: 200px" id="frontal-2">
                                    </div>
                                </div>
                                <div class="col-sm-6">
                                    <div class="form-group">
                                        <label for="exampleInputEmail1">Reverso</label>
                                        <img src=""
                                             class="rounded mx-auto d-block" alt="..."
                                             style="width: 250px; height: 200px" id="reverso-2">
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-4">
                                    <label for="exampleInputEmail1">Podres</label>
                                    <img src=""
                                         class="rounded mx-auto d-block" alt="..."
                                         style="width: 150px; height: 200px" id="podres">
                                </div>
                                <div class="col-md-8">
                                    <label for="exampleInputEmail1">Firma</label>
                                    <div style="border: 1px dashed green" class="rounded p-3">
                                        <img src=""
                                             class="rounded mx-auto d-block" alt="..."
                                             style="width: 200px; height: 150px;" id="signature">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="reject-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Rechazar Aprobación</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <form>
                    {{!-- <div class="form-group">
                        <label for="recipient-name" class="control-label">Razón del rechazo:</label>
                        <input type="text" class="form-control" id="recipient-name1">
                    </div> --}}
                    <div class="form-group">
                        <label for="" class="control-label">Asignar Agente:</label>
                        <select class="form-control select2-dropdown" id="agent" style="width:100%">
                            {{#each userlist}}
                                <option value="{{id}}">{{name}} {{lastname}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">Razón del Rechazo</label>
                        <textarea class="form-control" id="message-text-reject" rows="10"></textarea>
                    </div>
                    <div id="msg-footer"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" id="saveRejectDetails" class="btn btn-primary">Rechazar</button>
            </div>
        </div>
    </div>
</div>
<script>
    $('.js-switch').each(function () {
        new Switchery($(this)[0], $(this).data());
    });

    function scrollToBottom() {
        console.log("Hi there")
        var objDiv = document.getElementById("scroller-div");
        objDiv.scrollTop = objDiv.scrollHeight;
    }

    function markReadOfClientMailboxMsgs() {
        var url = "/kyb/{{org}}/{{currentProject}}/markReadOfClientMailboxMsgs";
        var data = {
            carisId: "{{carisId}}"
        }
        $.ajax({
            method: "post",
            url: url,
            data: data,
            success: function (data) {
                // console.log('data', data)
                if (data.success === true) {
                    // console.log(data)
                }
            },
            error: function (data) {
                toastr.error('Technical Error');
            }
        })
    }

    $(document).ready(function () {

        scrollToBottom();

        markReadOfClientMailboxMsgs();

        $('#moreInfoBtn').on('click', function (e) {
            e.preventDefault();
            $('#more-Info').modal('show');
        })

        $(".accionistasSingleInfo").click(function () {
            // console.log("Hit")
            var formId = $(this).attr("data-id");
            var url = "/kyb/{{org}}/{{currentProject}}/{{carisId}}/view/accionistas/" + formId;
            $.ajax({
                method: "POST",
                url: url,
                success: function (data) {
                    console.log('data', data);
                    $('#nombre').val(data.nombre_completo);
                    $('#curp').val(data.curp);
                    $('#participation').val(data.percentage_de_participacion);
                    var sdkAPIendpoint = `{{sdkAPIendpoint}}`;
                    $('#frontal').attr('src', sdkAPIendpoint + "/tmp/kyb/" + data.frontal.filename)
                    $('#reverso').attr('src', sdkAPIendpoint + "/tmp/kyb/" + data.reverso.filename)

                    $('#accionistasSingleInfoModal').modal('show');
                    // if (data.success === true) {
                    //     $('#accionistasSingleInfoModal').modal('show');
                    // } else {
                    //     toastr.error(data.message);
                    // }
                },
                error: function (data) {
                    toastr.error('Technical Error');
                }
            })
        })

        $(".apoderadosSingleInfo").click(function () {
            // console.log("Hit")
            var formId = $(this).attr("data-id");
            var url = "/kyb/{{org}}/{{currentProject}}/{{carisId}}/view/apoderados/" + formId;
            $.ajax({
                method: "POST",
                url: url,
                success: function (data) {
                    console.log('data', data);
                    $('#nombre-2').val(data.nombre_completo);
                    $('#curp-2').val(data.curp);
                    if (data.poderes_incluidos === "yes") {
                        $("#podres_includes").prop("checked", true);
                    } else {
                        $("#podres_includes").prop("checked", false);
                    }
                    var sdkAPIendpoint = `{{sdkAPIendpoint}}`;
                    $('#frontal-2').attr('src', sdkAPIendpoint + "/tmp/kyb/" + data.frontal.filename)
                    $('#reverso-2').attr('src', sdkAPIendpoint + "/tmp/kyb/" + data.reverso.filename)
                    $('#podres').attr('src', "https://image.flaticon.com/icons/png/512/46/46532.png")
                    $('#signature').attr('src', data.signatureURL)
                    $('#apoderadosSingleInfoModal').modal('show');
                },
                error: function (data) {
                    toastr.error('Technical Error');
                }
            })
        })

        $(".select2-dropdown").select2({
            placeholder: "Seleccione un agente"
        });

        $('body').on('click', '#aprobar', function (e) {
            e.preventDefault();

            Swal.fire({
                title: "Desea aprobar este proceso?",
                text: "Al aprobar este proceso automaticamente sera asignado a su supervisor",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    var url = "/kyb/{{org}}/{{currentProject}}/setApproved";
                    var data = {
                        carisId: "{{carisId}}"
                    }
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            if (data.success === true) {
                                toastr.success('Proceso Aprobado', function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000);
                                });
                            } else {
                                toastr.error(data.message);
                            }
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('body').on('click', '#rechazar', function (e) {
            e.preventDefault();

            Swal.fire({
                title: "Desea aprobar este proceso?",
                text: "Al aprobar este proceso automaticamente sera asignado a su supervisor",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    var url = "/kyb/{{org}}/{{currentProject}}/setRejected";
                    var data = {
                        carisId: "{{carisId}}"
                    }
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            if (data.success === true) {
                                toastr.success('Proceso Aprobado', function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000);
                                });
                            } else {
                                toastr.error(data.message);
                            }
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('body').on('click', '#done', function (e) {
            e.preventDefault();

            Swal.fire({
                title: "Desea aprobar este proceso?",
                text: "Al aprobar este proceso se cambiara su estado a Completado",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    var url = "/kyc/{{org}}/{{currentProject}}/setDone";
                    var data = {
                        carisId: "{{carisId}}"
                    }
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            if (data.success === true) {
                                toastr.success('Proceso Completado', function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000);
                                });
                            } else {
                                toastr.error(data.message);

                            }
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('body').on('click', '#saveRequestDetails', function (e) {
            e.preventDefault();

            if ($('#message-text').val().length <= 0) {

                $('#message-text').after('<div class="error">Este campo es requerido</div>')

                return false;

            }

            var url = "/kyb/{{org}}/{{currentProject}}/requestMoreInfo";
            var data = {
                carisId: "{{carisId}}",
                message: $('#message-text').val()
            }

            Swal.fire({
                title: "Confirmar esta acción",
                text: "Desea enviarle este mensaje a el cliente",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            // console.log('data', data)
                            $('#more-Info').modal('hide');
                            toastr.success('Mensaje Enviado', function () {
                                setTimeout(function () {
                                    window.location.reload()
                                }, 1000);
                            });
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });


        $('body').on('click', '#saveRejectDetails', function (e) {
            e.preventDefault();

            if ($('#message-text-reject').val().length <= 0) {

                $('#message-text-reject').after('<div class="error">Este campo es requerido</div>')

                return false;

            }

            var url = "/kyc/{{org}}/{{currentProject}}/setRejects";
            var data = {
                carisId: "{{carisId}}",
                message: $('#message-text-reject').val(),
                agent: $('#agent').val()
            }
            console.log('dat', data)


            Swal.fire({
                title: "Confirmar esta acción",
                text: "Desear Rechazar esta solicitud?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            $('#reject-modal').modal('hide');
                            toastr.success('Se ha rechazado esta solicitud', function () {
                                setTimeout(function () {
                                    window.location.reload()
                                }, 1000);
                            });
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('#reject').on('click', function (e) {
            e.preventDefault();
            $('#reject-modal').modal('show');
        });


        $('body').on('click', '#pdf', function (e) {
            e.preventDefault();
            var org = $.trim("{{org}}")
            var caris = "{{carisId}}";
            console.log('caris', caris)
            var current = window.location.href
            var arr = current.split("/");
            var result = arr[0] + "//" + arr[2]
            var url = "kyb/" + org + "/{{currentProject}}/getPdfInfo/{{carisId}}";
            var _url = result + '/' + url;
            console.log('_url', url)
            window.open(_url, '_blank');


        });
        //TODO test this ajax against the setCustomerInformation api URL
        $("#btnEditCustomerInfo").click(function () {
            $.ajax({
                method: "post",
                url: "/kyc/update",
                data: {
                    customerId: "{{customer._id}}",
                    name: $("#name").val(),
                    lastname: $("#lastname").val(),
                    secondlastname: $("#secondlastname").val(),
                    email: $("#email").val(),
                    address: $("#address").val(),
                },
                success: function (data) {
                    if (data.success === true) {
                        toastr.success(data.message, function () {
                            setTimeout(function () {
                                window.location.href = '/dashboard/projects';
                            }, 2000);
                        });
                    } else {
                        toastr.error(data.message);
                    }
                },
                error: function (data) {
                    toastr.error('Technical Error');
                }
            });
        });

        $('#list-table').DataTable({
            language: {
                "url": "/dist/js/dataTable.es.json",
            },
            dom: 'Bfrtipl',
            buttons: [
                'excelHtml5',
                'csvHtml5',
                'pdfHtml5',
                'pageLength',
            ],
            "pageLength": 25
        });

        $('#list-table-2').DataTable({
            language: {
                "url": "/dist/js/dataTable.es.json",
            },
            dom: 'Bfrtipl',
            buttons: [
                'excelHtml5',
                'csvHtml5',
                'pdfHtml5',
                'pageLength',
            ],
            "pageLength": 25
        });
    });

</script>
