<style>
    .vtabs .tabs-vertical {
        width: 250px;
    }

    .full-width-btn {
        width: 100%;
        margin: 5px 0;
    }

    .padding0 {
        padding: 0;
    }

    .customer-name {
        margin-top: 15px;
    }

    .maxHeigh135 {
        height: 135px;
    }

    .small-font h1 {
        font-size: 26px !important;
    }

    .error {
        color: red;
    }

</style>
{{#if error}}
    <div id="error" class="alert alert-danger" style="margin-top: 25px;">{{errMessage}}</div>
{{/if}}
<div class="row page-titles">
    <div class="col-md-5 align-self-center">
        <h4 class="text-themecolor">Conozca su cliente (Know your Customer)</h4>
    </div>
    <div class="col-md-7 align-self-center text-right">
        <div class="d-flex justify-content-end align-items-center">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="#">Home</a></li>
                <li class="breadcrumb-item active">KYC Físico / Cliente:</li>
            </ol>

        </div>
    </div>
</div>

<div class="row">
    <!-- Column -->
    <div class="col-lg-3 col-xlg-2 col-md-4">
        <div class="card"><img class="card-img" src="/img/bg1.jpg" height="280" alt="Card image">
            <div class="card-img-overlay card-inverse text-white social-profile d-flex justify-content-center">
                <div class="align-self-center"><img src="/img/profile-placeholder.png" class="img-circle" width="100">


                    {{#if isEdit}}
                        <input type="text" class="form-control mb-1 mt-1" placeholder="Name" id="name" name="name"
                               value="{{customer.name}}">
                        <input type="text" class="form-control mb-1" placeholder="Last Name" id="name" name="lastname"
                               value="{{customer.lastname}}">
                        <input type="text" class="form-control mb-1" placeholder="Second Last Name" id="name"
                               name="secondlastname"
                               value="{{customer.secondlastname}}">
                    {{else}}
                        <h4 class="card-title customer-name">{{customer.name}} {{customer.lastname}} {{customer.secondlastname}}</h4>
                    {{/if}}
                    <small>Agente Asignado <br> {{owner}} </small>
                </div>
            </div>
        </div>
        {{#if permissions.kyc.hasCreate}}
        <div class="col-lg-12 col-xlg-12 col-md-12 padding0">
            <button type="button" class="btn waves-effect waves-light btn-outline-secondary full-width-btn" id="assign">
                Asignarme este proceso
            </button>
            <button type="button" class="btn waves-effect waves-light btn-warning full-width-btn" id="moreInfoBtn">
                Solicitar mas Información al cliente
            </button>
            {{#if showApproveBtn }}
                <button type="button" class="btn waves-effect waves-light btn-info full-width-btn" id="aprobar">
                    Aprobar
                </button>
            {{/if}}
            {{#if showPDFBtn}}
                <button type="button" class="btn waves-effect waves-light btn-outline-secondary full-width-btn"
                        id="pdf">Descargar PDF
                </button>
            {{/if}}
            {{#if showSupervisorBtn}}
                <button type="button" class="btn waves-effect waves-light btn-success full-width-btn" id="done">
                    Aprobar
                </button>
                <button type="button" class="btn waves-effect waves-light btn-danger full-width-btn" id="reject">
                    Rechazar
                </button>
            {{/if}}
            {{#if isEdit}}
                <button type="button" class="btn waves-effect waves-light btn-dark full-width-btn"
                        id="btnEditCustomerInfo">Edit Customer Details
                </button>
            {{/if}}
        </div>
        {{/if}}
        <br>
        <div class="card">
            <div class="card-header">
                Comunicación con el cliente
            </div>
            <div class="card-body">
                <ul class="nav nav-tabs customtab" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" data-toggle="tab" href="#home2" role="tab" aria-selected="true">
                            <span class="hidden-sm-up"></span> <span class="hidden-xs-down">Solicitudes</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" data-toggle="tab" href="#profile2" role="tab" aria-selected="false">
                            <span class="hidden-sm-up"></span> <span class="hidden-xs-down">Rechazado</span>
                        </a>
                    </li>

                </ul>
                <div class="tab-content" style="max-height: 350px;height: 350px;overflow: scroll;">
                    <div class="tab-pane active" id="home2" role="tabpanel">
                        <ul class="chat-list">
                            {{#each info.revisions}}
                                <li>
                                    <div class="chat-content">
                                        <h5>{{user.userName}} </h5>
                                        <div class="box bg-light-info" style="width:100%">{{message}}</div>
                                    </div>
                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA timestamp}}</div>
                                </li>
                            {{else}}
                                <li>
                                    <div class="chat-content">
                                        <h5>No hay conversaciones</h5>
                                        {{!-- <div class="box bg-light-info">Well we have good budget for the project</div> --}}
                                    </div>
                                </li>
                            {{/each}}

                        </ul>
                    </div>
                    <div class="tab-pane" id="profile2" role="tabpanel">
                        <ul class="chat-list">
                            {{#each info.rejects}}
                                <li>
                                    <div class="chat-content">
                                        <h5>{{user.userName}} <span class="badge badge-danger">Rechazado</span></h5>
                                        <div class="box alert-wati" style="width:100%">{{message}}</div>
                                    </div>
                                    <div class="chat-time" style="margin-left:15px">{{parse_dateSSA timestamp}}</div>
                                </li>
                            {{else}}
                                <li>
                                    <div class="chat-content">
                                        <h5>No hay rechazos</h5>
                                        {{!-- <div class="box bg-light-info">Well we have good budget for the project</div> --}}
                                    </div>
                                </li>
                            {{/each}}

                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <div class="card">
            <div class="card-body"><small class="text-muted">Email </small>
                {{#if isEdit}}
                    <input type="text" class="form-control mb-1" placeholder="Customer Email" id="email" name="email"
                           value="{{customer.email}}">
                    <input type="text" class="form-control mb-1" placeholder="Cell Phone" id="cellPhone"
                           name="cellPhone" value="{{customer.cellPhone}}">
                    <input type="text" class="form-control mb-1" placeholder="address" id="address" name="address"
                           value="{{customer.address}}">
                    <input type="hidden" id="customerId" name="customerId" value="{{customer._id}}">
                {{else}}
                    <h6>{{customer.email}}</h6> <small class="text-muted p-t-30 db">Email</small>
                    <h6>{{customer.cellPhone}}</h6> <small class="text-muted p-t-30 db">Teléfono</small>
                    <h6>{{customer.address}}</h6><small class="text-muted p-t-30 db">Dirección</small>
                {{/if}}

                <div class="map-box">
                    <iframe id="gmap_canvas" src="https://maps.google.com/maps?q={{customer.address}}
                    &t=&z=13&ie=UTF8&iwloc=&output=embed" width="100%" height="150" frameborder="0" scrolling="no"
                    marginheight="0" marginwidth="0"></iframe>
                </div>
                <small class="text-muted p-t-30 db">Redes Sociales</small>
                <br>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-facebook-f"></i></button>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-twitter"></i></button>
                <button class="btn btn-circle btn-secondary"><i class="fab fa-youtube"></i></button>
            </div>
        </div>
    </div>
    <!-- Column -->
    <!-- Column -->

    <div class="col-lg-9 col-xlg-10 col-md-8">
        {{!-- <div class="card button-bar">

           <div class="btn-group pull-right" role="group" aria-label="Basic example">
               <button type="button" class="btn btn-secondary">Left</button>
               <button type="button" class="btn btn-secondary">Middle</button>
               <button type="button" class="btn btn-secondary">Right</button>
           </div>
       </div> --}}
        <div class="row">
            <!-- Column -->
            {{#if hasNoOwner}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-danger"> Este cliente no tiene ningun asesor asignado.
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                    </div>
                </div>
            {{/if}}
            {{#if hasNoEmail}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-warning">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                        <h3 class="text-warning"><i class="fa fa-exclamation-triangle"></i> Precaución</h3> Este cliente
                        no tiene ningun correo electrónico asociado, es un nivel de riesgo alto.
                    </div>
                </div>
            {{/if}}
            {{#if_eq info.status 'approved'}}
                <div class="col-lg-12 col-md-12">
                    <div class="alert alert-info">
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span
                                aria-hidden="true">×</span></button>
                        <h3 class="text-info"><i class="fa fa-exclamation-circle"></i> Importante</h3> Este cliente esta
                        en espera de revisión por parte de un supervisor.
                    </div>
                </div>
            {{/if_eq}}
            <div class="col-lg-4 col-md-6">
                <div class="card">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">N/D</h1>
                                <h6 class="text-muted">Nivel de Riesgo</h6></div>
                            <!-- Column -->
                            <div class="col text-right align-self-center">
                                <div data-label="20%" class="css-bar m-b-0 css-bar-primary css-bar-20"><i
                                        class="mdi mdi-account-circle"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-4 col-md-6">
                <div class="card">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">{{views}}</h1>
                                <h6 class="text-muted">Visualizaciones</h6></div>
                            <!-- Column -->
                            <div class="col text-right align-self-center">
                                <div data-label="30%" class="css-bar m-b-0 css-bar-danger css-bar-20"><i
                                        class="mdi mdi-briefcase-check"></i></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
            <!-- Column -->
<!--            <div class="col-lg-3 col-md-6">-->
<!--                <div class="card">-->
<!--                    <div class="card-body maxHeigh135">-->
<!--                        <div class="row p-t-10 p-b-10">-->
<!--                            &lt;!&ndash; Column &ndash;&gt;-->
<!--                            <div class="col p-r-0">-->
<!--                                <h1 class="font-light">N/D</h1>-->
<!--                                <h6 class="text-muted">Tiempo en el formulario</h6></div>-->
<!--                            &lt;!&ndash; Column &ndash;&gt;-->
<!--                            <div class="col text-right align-self-center">-->
<!--                                <div data-label="40%" class="css-bar m-b-0 css-bar-warning css-bar-40"><i-->
<!--                                        class="mdi mdi-star-circle"></i></div>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->
<!--                </div>-->
<!--            </div>-->
            <!-- Column -->
            <!-- Column -->
            <div class="col-lg-4 col-md-6">
                <div class="card text-white {{parseStatusColor customer.status}}">
                    <div class="card-body maxHeigh135">
                        <div class="row p-t-10 p-b-10">
                            <!-- Column -->
                            <div class="col p-r-0">
                                <h1 class="font-light">{{parseStatus customer.status}}</h1>
                                <h6 class=" text-white">Estado</h6></div>
                            <!-- Column -->

                        </div>
                    </div>
                </div>
            </div>
            <!-- Column -->
        </div>

        <div class="card">
            <!-- Nav tabs -->
            <div class="vtabs customvtab">
                <ul class="nav nav-tabs profile-tab tabs-vertical" role="tablist">
                    <li class="nav-item"><a class="nav-link active" data-toggle="tab" href="#home" role="tab">Información
                        Basica</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#laboral" role="tab">Información
                        Laboral</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#politic" role="tab">Información
                        Politica</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#founds" role="tab">Origen de los
                        fondos</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#banking" role="tab">Información
                        Bancaria</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#activity" role="tab">Actividad
                        Esperada</a></li>
                    <li class="nav-item"><a class="nav-link" data-toggle="tab" href="#attachements" role="tab">Archivos
                        Adjuntos</a></li>
                    {{!-- <li class="nav-item"> <a class="nav-link" data-toggle="tab" href="#history" role="tab">Historial</a> </li> --}}
                </ul>
                <!-- Tab panes -->
                <div class="tab-content">
                    <div class="tab-pane active" id="home" role="tabpanel">

                        {{#each customerInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each block.fields}}
                                        {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                    {{/each}}
                                </div>
                            </div>
                        {{else}}
                            Error retrieving customerInfo, please contact an Hubex Admin
                        {{/each}}

                    </div>
                    <!--second tab-->
                    <div class="tab-pane" id="laboral" role="tabpanel">
                        {{#each laboralInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each block.fields}}
                                        {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                    {{/each}}
                                </div>
                            </div>
                        {{else}}
                            Error retrieving laboralInfo, please contact an Hubex Admin
                        {{/each}}
                    </div>
                    <div class="tab-pane" id="politic" role="tabpanel">
                        {{#each politicalInfo}}
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{block.name}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each block.fields}}
                                        {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                    {{/each}}
                                </div>
                            </div>
                        {{else}}
                            Error retrieving laboralInfo, please contact an Hubex Admin
                        {{/each}}
                    </div>
                    <div class="tab-pane" id="founds" role="tabpanel">
                        <div class="card-body">
                            {{#each foundOrigins}}
                                <div class="card-header bg-info">
                                    <h4 class="m-b-0 text-white">{{block.name}}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        {{#each block.fields}}
                                            {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                        {{/each}}
                                    </div>
                                </div>
                            {{else}}
                                Error retrieving foundOrigins, please contact an Hubex Admin
                            {{/each}}
                        </div>
                    </div>
                    <div class="tab-pane" id="banking" role="tabpanel">
                        <div class="card-body">
                            {{#each bankingInfo}}
                                <div class="card-header bg-info">
                                    <h4 class="m-b-0 text-white">{{block.name}}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        {{#each block.fields}}
                                            {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                        {{/each}}
                                    </div>
                                </div>
                            {{else}}
                                Error retrieving bankingInfo, please contact an Hubex Admin
                            {{/each}}
                        </div>
                    </div>
                    <div class="tab-pane" id="activity" role="tabpanel">
                        <div class="card-body">
                            {{#each expectedActivity}}
                                <div class="card-header bg-info">
                                    <h4 class="m-b-0 text-white">{{block.name}}</h4>
                                </div>
                                <div class="card-body">
                                    <div class="row">
                                        {{#each block.fields}}
                                            {{{drawInput label initialValue type isSelected desktopSize helper}}}
                                        {{/each}}
                                    </div>
                                </div>
                            {{else}}
                                Error retrieving bankingInfo, please contact an Hubex Admin
                            {{/each}}
                        </div>
                    </div>
                    <div class="tab-pane" id="attachements" role="tabpanel">
                        <div class="card-body">
                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedThirdPartySectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                            {{#each attachedThirdPartyImages}}
                                <div class="form-group col-md-4">
                                    <div class="img-frame">
                                        <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                           style="color:#fff" download="{{filename}}">
                                            <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                 height="250" width="250" {{{attr}}} style="padding: 20px">
                                        </a>
                                    </div>
                                </div>
                            {{else}}
                                NO Third Party Pictures avialable
                            {{/each}}
                                </div>
                            </div>


                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedWorkDocPicSectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each attachedWorkDocPicImages}}
                                        <div class="form-group col-md-4">
                                            <div class="img-frame">
                                                <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                                   style="color:#fff" download="{{filename}}">
                                                    <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                         height="250" width="250" {{{attr}}} style="padding: 20px">
                                                </a>
                                            </div>
                                        </div>
                                    {{else}}
                                        No work documents available
                                    {{/each}}
                                </div>
                            </div>


                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedIdPicFrontSectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each attachedIdPicFrontImages}}
                                        <div class="form-group col-md-4">
                                            <div class="img-frame">
                                                <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                                   style="color:#fff" download="{{filename}}">
                                                    <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                         height="250" width="250" {{{attr}}} style="padding: 20px">
                                                </a>
                                            </div>
                                        </div>
                                    {{else}}
                                        No Front ID picture available
                                    {{/each}}
                                </div>
                            </div>

                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedIdPicBackSectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each attachedIdPicBackImages}}
                                        <div class="form-group col-md-4">
                                            <div class="img-frame">
                                                <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                                   style="color:#fff" download="{{filename}}">
                                                    <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                         height="250" width="250" {{{attr}}} style="padding: 20px">
                                                </a>
                                            </div>
                                        </div>
                                    {{else}}
                                        No back Id photo available
                                    {{/each}}
                                </div>
                            </div>

                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedPublicServiceSectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each attachedPublicServiceImages}}
                                        <div class="form-group col-md-4">
                                            <div class="img-frame">
                                                <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                                   style="color:#fff" download="{{filename}}">
                                                    <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                         height="250" width="250" {{{attr}}} style="padding: 20px">
                                                </a>
                                            </div>
                                        </div>
                                    {{else}}
                                        No Public Service documents available
                                    {{/each}}
                                </div>
                            </div>

                            <div class="card-header bg-info">
                                <h4 class="m-b-0 text-white">{{attachedSignatureSectionName}}</h4>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    {{#each attachedSignatureImages}}
                                        <div class="form-group col-md-4">
                                            <div class="img-frame">
                                                <a href="{{../imgUrl}}/{{filename}}" target="_blank"
                                                   style="color:#fff" download="{{filename}}">
                                                    <img src="{{../imgUrl}}/{{filename}}" alt="{{name}}"
                                                         height="250" width="250" {{{attr}}} style="padding: 20px">
                                                </a>
                                            </div>
                                        </div>
                                    {{else}}
                                        No signature available
                                    {{/each}}
                                </div>
                            </div>

                        </div>
                    </div>
                    <div class="tab-pane" id="history" role="tabpanel">
                        <div class="card-body">
                            Historial
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Column -->
</div>
<div class="modal fade" id="more-Info" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Solicitar mas información</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <form>
                    <!-- <div class="form-group">
                        <label for="recipient-name" class="control-label">Razón del rechazo:</label>
                        <input type="text" class="form-control" id="recipient-name1">
                    </div> -->
                    {{!-- <div class="form-group">
                        <label for="message-text" class="control-label">Destinatario:</label>
                        <input class="form-control" id="message-header" type="text" />
                    </div> --}}
                    <div class="form-group">
                        <!-- <label for="message-text" class="control-label">:</label> -->
                        <textarea class="form-control" id="message-text" rows="10"></textarea>
                    </div>
                    <div id="msg-footer"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" id="saveRequestDetails" class="btn btn-primary">Enviar</button>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="reject-modal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel1"
     aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="exampleModalLabel1">Rechazar Aprobación</h4>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span
                        aria-hidden="true">×</span></button>
            </div>
            <div class="modal-body">
                <form>
                    {{!-- <div class="form-group">
                        <label for="recipient-name" class="control-label">Razón del rechazo:</label>
                        <input type="text" class="form-control" id="recipient-name1">
                    </div> --}}
                    <div class="form-group">
                        <label for="" class="control-label">Asignar Agente:</label>
                        <select class="form-control select2-dropdown" id="agent" style="width:100%">
                            {{#each userlist}}
                                <option value="{{id}}">{{name}} {{lastname}}</option>
                            {{/each}}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="message-text" class="control-label">Razón del Rechazo</label>
                        <textarea class="form-control" id="message-text-reject" rows="10"></textarea>
                    </div>
                    <div id="msg-footer"></div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">Cancelar</button>
                <button type="button" id="saveRejectDetails" class="btn btn-primary">Rechazar</button>
            </div>
        </div>
    </div>
</div>
<script>
    $('.js-switch').each(function () {
        new Switchery($(this)[0], $(this).data());
    });

    function saveOwner() {
        var url = "/kyc/{{org}}/{{currentProject}}/setOwner";
        var data = {
            carisId: "{{carisId}}",
            owner: "{{user.id}}"
        }
        $.ajax({
            method: "post",
            url: url,
            data: data,
            success: function (data) {
                console.log('data', data)
                if (data.success === true) {
                    toastr.success('Agente Asignado con Éxito', function () {
                        setTimeout(function () {
                            window.location.reload()
                        }, 1000);
                    });
                } else {
                    toastr.error(data.message);

                }
            },
            error: function (data) {
                toastr.error('Technical Error');
                //$(this).prop('disabled', false);
            }
        })
                .done(function () {
                    //$(this).prop('disabled', false);
                })
                .fail(function () {
                    toastr.error('Request Failed');
                    //$(this).prop('disabled', false);
                })
    }

    $(document).ready(function () {

        $('#moreInfoBtn').on('click', function (e) {
            e.preventDefault();
            if ({{hasNoEmail}}) {
                Swal.fire({
                    title: "Este cliente no tiene correo electrónico",
                    text: "Comunicarse directamente al teléfono: {{customer.cellPhone}}",
                    icon: 'warning',
                    showCancelButton: false,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#e46a76',
                    confirmButtonText: 'Aceptar',
                    cancelButtonText: 'No!'
                }).then(function (result) {
                    if (result.value) {

                    }
                })
            } else {
                $('#more-Info').modal('show');
            }


        })

        $(".select2-dropdown").select2({
            placeholder: "Seleccione un agente"
        });

        $('body').on('click', '#assign', function (e) {
            e.preventDefault();
            if ({{hasNoOwner}}) {
                saveOwner()
            } else {

                Swal.fire({
                    title: "Este cliente tiene un agente asignado",
                    text: "Desea asignarse este cliente?",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#3085d6',
                    cancelButtonColor: '#e46a76',
                    confirmButtonText: 'Si!',
                    cancelButtonText: 'No!'
                }).then(function (result) {
                    if (result.value) {
                        saveOwner()
                    }
                })
            }


        });
        $('body').on('click', '#aprobar', function (e) {
            e.preventDefault();

            Swal.fire({
                title: "Desea aprobar este proceso?",
                text: "Al aprobar este proceso automaticamente sera asignado a su supervisor",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    var url = "/kyc/{{org}}/{{currentProject}}/setApproved";
                    var data = {
                        carisId: "{{carisId}}"
                    }
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            if (data.success === true) {
                                toastr.success('Proceso Aprobado', function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000);
                                });
                            } else {
                                toastr.error(data.message);

                            }
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('body').on('click', '#done', function (e) {
            e.preventDefault();

            Swal.fire({
                title: "Desea aprobar este proceso?",
                text: "Al aprobar este proceso se cambiara su estado a Completado",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    var url = "/kyc/{{org}}/{{currentProject}}/setDone";
                    var data = {
                        carisId: "{{carisId}}"
                    }
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            if (data.success === true) {
                                toastr.success('Proceso Completado', function () {
                                    setTimeout(function () {
                                        window.location.reload()
                                    }, 1000);
                                });
                            } else {
                                toastr.error(data.message);

                            }
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('body').on('click', '#saveRequestDetails', function (e) {
            e.preventDefault();

            if ($('#message-text').val().length <= 0) {

                $('#message-text').after('<div class="error">Este campo es requerido</div>')

                return false;

            }

            var url = "/kyc/{{org}}/{{currentProject}}/requestMoreInfo";
            var data = {
                carisId: "{{carisId}}",
                message: $('#message-text').val()
            }

            Swal.fire({
                title: "Confirmar esta acción",
                text: "Desea enviarle este mensaje a el cliente",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            $('#more-Info').modal('hide');
                            toastr.success('Mensaje Enviado', function () {
                                setTimeout(function () {
                                    window.location.reload()
                                }, 1000);
                            });
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });


        $('body').on('click', '#saveRejectDetails', function (e) {
            e.preventDefault();

            if ($('#message-text-reject').val().length <= 0) {

                $('#message-text-reject').after('<div class="error">Este campo es requerido</div>')

                return false;

            }

            var url = "/kyc/{{org}}/{{currentProject}}/setRejects";
            var data = {
                carisId: "{{carisId}}",
                message: $('#message-text-reject').val(),
                agent: $('#agent').val()
            }
            console.log('dat', data)


            Swal.fire({
                title: "Confirmar esta acción",
                text: "Desear Rechazar esta solicitud?",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#e46a76',
                confirmButtonText: 'Si!',
                cancelButtonText: 'No'
            }).then(function (result) {
                if (result.value) {
                    $.ajax({
                        method: "post",
                        url: url,
                        data: data,
                        success: function (data) {
                            console.log('data', data)
                            $('#reject-modal').modal('hide');
                            toastr.success('Se ha rechazado esta solicitud', function () {
                                setTimeout(function () {
                                    window.location.reload()
                                }, 1000);
                            });
                        },
                        error: function (data) {
                            toastr.error('Technical Error');
                            //$(this).prop('disabled', false);
                        }
                    })
                            .done(function () {
                                //$(this).prop('disabled', false);
                            })
                            .fail(function () {
                                toastr.error('Request Failed');
                                //$(this).prop('disabled', false);
                            })
                }
            })

        });

        $('#reject').on('click', function (e) {
            e.preventDefault();
            $('#reject-modal').modal('show');
        });


        $('body').on('click', '#pdf', function (e) {
            e.preventDefault();
            var org = $.trim("{{org}}")
            var caris = "{{carisId}}";
            console.log('caris', caris)
            var current = window.location.href
            var arr = current.split("/");
            var result = arr[0] + "//" + arr[2]
            var url = "kyc/" + org + "/{{currentProject}}/getPdfInfo/{{carisId}}";
            var _url = result + '/' + url;
            console.log('_url', url)
            window.open(_url, '_blank');


        });
        //TODO test this ajax against the setCustomerInformation api URL
        $("#btnEditCustomerInfo").click(function () {
            $.ajax({
                method: "post",
                url: "/kyc/update",
                data: {
                    customerId: "{{customer._id}}",
                    name: $("#name").val(),
                    lastname: $("#lastname").val(),
                    secondlastname: $("#secondlastname").val(),
                    email: $("#email").val(),
                    address: $("#address").val(),
                },
                success: function (data) {
                    if (data.success === true) {
                        toastr.success(data.message, function () {
                            setTimeout(function () {
                                window.location.href = '/dashboard/projects';
                            }, 2000);
                        });
                    } else {
                        toastr.error(data.message);
                    }
                },
                error: function (data) {
                    toastr.error('Technical Error');
                }
            });
        });
    });

</script>
